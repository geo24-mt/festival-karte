<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet-search.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
		<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/de.js"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
		<link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
		<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
		<link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
        <style>
	       html, body {
			    width: 100%; 
			    height: 100%;
			    margin: 0;
			    gap: 40px;
			    background: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.8)), 
			                url('background.png') center/cover fixed no-repeat;
			   overflow: hidden;
		}
			#map {
			    width: 100%; 
			    height: 100%;
			    border: 1px solid #333;
			    box-sizing: border-box;
		}
			#Überschrift {
				top: 0px !important;
				box-sizing: border-box;
				height: 110px;
				width: 100%;
				background: linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71);
				background-size: 400% 400%;
				animation: holi-flow 10s ease infinite;
				border: 15px double black;
				border-radius:10px;
				display: flex;
				justify-content: center;
				align-items: center;
				overflow: hidden;
				position: relative;
				margin-bottom: 20px;
		}	
			@keyframes holi-flow {
				0% { background-position: 0% 50%; }
				50% { background-position: 100% 50%; }
				100% { background-position: 0% 50%; }
		}	
			#Überschrift h1 {
				text-align: center;
				margin: 10px;
				color: white;
				font-family: 'Bangers', system-ui;
				text-shadow: 
				3px 3px 0px #000,
				-1px -1px 0px #000,  
				1px -1px 0px #000,
				-1px 1px 0px #000,
				1px 1px 0px #000;
				letter-spacing: 3px;
				line-height: 1.2;
				z-index: 1;
				font-size: 2.8em;
				transform: rotate(-1deg);
				text-transform: uppercase;
		}	
			.my-tooltip, 
			.landkreis-tooltip, 
			.legende-links, 
			.menu-wrapper,
			.impressum-wrapper{
			    background: 
			        linear-gradient(rgba(30, 30, 30, 0.9), rgba(30, 30, 30, 0.9)) padding-box, 
			        linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71) border-box;
			    border: 3px solid transparent; 
			    color: #ffffff;
			    font-family: 'Montserrat', sans-serif;
			    box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
		}
			.leaflet-popup-content {
				font-family: 'Montserrat', sans-serif;
				font-size: 13px;
				line-height: 1.4;
		}	
			.leaflet-popup-content th {
				font-weight: 700; 
				text-transform: uppercase; 
				letter-spacing: 0.5px;
				color: #444;
				padding-right: 40px; 
				white-space: nowrap;
				text-align: left;
		}
			.my-tooltip, .landkreis-tooltip {
				border-radius: 10px; 
				padding: 8px 12px;
				font-size: 14px;
				font-weight: bold;
		}
			.karten-zentrierer {
			    position: relative;
			    width: 60%;         
			    min-width: 350px;   
			    margin: 0 auto;    
				height: calc(100vh - 150px); /* Gibt dem Container eine feste Höhe */		
		}
			.menu-wrapper, .impressum-wrapper, .legende-links {
			    position: absolute !important;
			    top: 24%;
			    z-index: 2000;
			    padding: 3px;
			    border-radius: 12px; 
				box-sizing: border-box;
				width: 220px;     
			    min-width: 180px; 
			    max-width: 240px;  
		}
			.legende-links {
			    top: 58%;
			    transform: translateY(-50%); 
			    padding: 15px 30px;
			    display: flex;
			    flex-direction: column;
			    gap: 15px;
		}
			.menu-wrapper {
			    left: calc(100% + 30px); 
			    right: auto !important;
		}
			.legende-links, .impressum-wrapper {
			    right: calc(100% + 30px); 
			    left: auto !important;
		}
			#filter-menu, #filter-kategorie, .slider-container {
				background-color: rgb(30, 30, 30) !important; 
				color: white;
				border: none;
				border-radius: 9px;
				width: 100%;
				box-sizing: border-box;
		}
			#filter-menu, #filter-kategorie {
				font-family: 'Montserrat', sans-serif;
				font-size: 14px;
				font-weight: bold;
				cursor: pointer;
				text-align: center;
    			text-align-last: center;
				height: 40px;
		}
			.slider-container {
				background-color: rgba(30, 30, 30, 0.95) !important;
				border-radius: 9px;
				padding: 5px;
				display: flex;
				flex-direction: column;
				justify-content: center;
				height: auto; 
				box-sizing: border-box;
				overflow: hidden; 
		}
			.slider-label {
				display: block;      
    			text-align: center;
				color: white;
				font-family: 'Montserrat', sans-serif;
				font-weight: bold;
				font-size: 14px; 
				margin-bottom: 2px;
		}
			#preis-slider {
				-webkit-appearance: none;
				width: 100%;
				height: 5px;
				background: linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71) !important;
				border-radius: 5px;
				outline: none;
		}
			#preis-slider::-webkit-slider-thumb {
				-webkit-appearance: none;
				height: 16px;
				width: 16px;
				border-radius: 50%;
				background: rgba(210,210,210,1);
				cursor: pointer;
				border: 2px solid #333;
				margin-top: -5.5px; 
		}
			#preis-slider::-moz-range-thumb {
				height: 16px;
				width: 16px;
				border-radius: 50%;
				background: rgba(210,210,210,1);
				border: 2px solid #333;
		}
			.leaflet-tooltip {
				margin-top: -10px;
		}
			.leaflet-popup-content-wrapper {
				background-color: rgba(255, 255, 255, 0.95); 
				border: 4px solid transparent; 
				border-radius: 15px;
				background-image: linear-gradient(rgba(255, 255, 255, 0.98), rgba(245, 245, 245, 0.98)), 
								  linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71);
				background-origin: border-box;
				background-clip: padding-box, border-box;
				box-shadow: 0 10px 25px rgba(0,0,0,0.2);
				padding: 2px;
		}
			.hide-tooltips .landkreis-tooltip { 
				display: none !important; 
		}
			#reset-button:hover,
			#impressum-button:hover {
				color: #f39c12 !important; 
		}
		
			.flatpickr-calendar.inline {
				background: transparent !important;
				border: none !important;
				box-shadow: none !important;
				transform: scale(1); 
				transform-origin: top center; 
				margin: 0 auto !important;
				width: 100% !important;
		}
			.flatpickr-day {
				height: 28px !important;    
				line-height: 28px !important;
		}	
			flatpickr-innerContainer, .flatpickr-rContainer, .flatpickr-days, .dayContainer {
				width: 100% !important;
				min-width: 100% !important;
				max-width: 100% !important;
		}
			.flatpickr-months {
				height: 35px !important;   
		}
			.flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange {
				background: #76c7c0 !important;
				border-color: #76c7c0 !important;
				color: #1a1a1a !important; 
				font-weight: bold;
		}
			.flatpickr-day.inRange {
				background: rgba(118, 199, 192, 0.15) !important;
				box-shadow: none !important;
		}
			.legende-item {
			    display: flex;
			    align-items: center;
			    gap: 15px;
			    font-size: 14px;
		}
			.icon-wrapper {
			    width: 48px;  
			    height: 48px;
			    display: flex;
			    align-items: center;
			    justify-content: center;
			    flex-shrink: 0;
		}
			.icon-wrapper img {
			    width: 44px;  
			    height: 44px;
			    object-fit: contain;
		}   
			.festival-icon-style {
			    object-fit: contain; 
			    border: none !important; 
			    background: transparent !important;
		}
			.leaflet-control-zoom.leaflet-bar, 
			.leaflet-control-locate.leaflet-bar {
			    background: linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71) !important;
			    padding: 2px !important;
			    border-radius: 12px !important;
			    border: none !important;
			    box-shadow: 0 4px 15px rgba(0,0,0,0.3) !important;
		}
			.leaflet-control-zoom.leaflet-bar a,
			.leaflet-control-locate.leaflet-bar a {
			    background-color: white !important; 
			    border-radius: 10px !important;
			    border: none !important;
			    margin: 1px !important;
				overflow: hidden !important;
		}
			.multiselect-container {
			    position: relative;
			    background: transparent !important; 
			    color: white;
			    width: 100%;
		}
			#filter-menu .select-box-header, 
			#filter-kategorie .select-box-header {
				height: 100%;
				font-size: 14px;
				white-space: nowrap;
			    display: flex;
			    align-items: center;
			    justify-content: center;
			    background-color: rgb(30, 30, 30); 
			    border-radius: 9px;
			    font-family: 'Montserrat', sans-serif;
			    font-weight: bold;
			    box-sizing: border-box;
			    cursor: pointer;
				overflow: hidden;
		}
			.checkbox-content {
			    display: none; 
			    position: absolute; 
			    top: 105%; 
			    left: 0;
			    background-color: rgb(30, 30, 30);
			    width: 100%;
			    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5);
			    z-index: 10000; 
			    max-height: 200px;
			    overflow-y: auto;
			    border: 2px solid #444;
			    border-radius: 9px;
			    box-sizing: border-box;
		}
			.checkbox-item {
			    display: flex; 
			    align-items: center;
			    padding: 10px;
			    text-align: left;
			    font-size: 13px;
			    cursor: pointer;
			    transition: background 0.2s;
		}
			.checkbox-item input {
			    margin-right: 10px; 
		}
			.checkbox-item:hover {
			    background-color: #444;
		}


    /* Genaue Reihenfolge UNTER der Karte */
   .legende-links {
        order: 1 !important; /* Zwischen Überschrift und Karte */
        position: relative !important;
        width: 90% !important;
        margin: 10px auto !important;
        padding: 10px 5px !important;
        
        /* Das hier sorgt für die Anordnung NEBENEINANDER */
        display: flex !important;
        flex-direction: row !important; /* Symbole in einer Reihe */
        flex-wrap: wrap !important;    /* Wenn eine Reihe voll ist, wird umgebrochen */
        justify-content: center !important; /* Mittig ausrichten */
        gap: 15px !important;          /* Abstand zwischen den Symbolen */
    }

    .legende-item {
        display: flex !important;
        flex-direction: row !important; /* Icon und Text nebeneinander */
        align-items: center !important;
        font-size: 13px !important;
        gap: 5px !important;
    }
    .menu-wrapper:has(#filter-menu) { order: 3 !important; }
    .menu-wrapper:has(#filter-kategorie) { order: 4 !important; }
    .menu-wrapper:has(#preis-slider) { order: 5 !important; }
    .menu-wrapper:has(#event-kalender) { order: 6 !important; }
    .menu-wrapper:has(#reset-button) { order: 7 !important; }
    .impressum-wrapper { order: 8 !important; } /* Das Impressum ganz unten */
}
			
  </style>
        <title></title>
    </head>
  <body>

    <div id="Überschrift">
        <h1>Die Bunte Welt der Festivals</h1>
    </div>

    <div class="karten-zentrierer">

        <div class="menu-wrapper" style="z-index: 10000; top: 5%;"> <div id="filter-menu" class="multiselect-container">
                <div class="select-box-header" onclick="toggleCheckboxes()">
                    <span id="selected-text">- Landkreis wählen -</span>
                </div>
                <div id="checkbox-list" class="checkbox-content">
                    <input type="checkbox" id="all-kreise" style="display:none;" checked>
                    <div style="padding: 10px; display: flex; justify-content: center; gap: 15px; font-size: 13px; border-bottom: 1px solid #444; font-weight: bold;">
                        <span onclick="setAll(true)" style="cursor:pointer; color: #3498db;">[Alle an]</span>
                        <span onclick="setAll(false)" style="cursor:pointer; color: #e74c3c;">[Alle aus]</span>
                    </div>
                    <label class="checkbox-item"><input type="checkbox" class="kreis-check" value="Merzig-Wadern" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Merzig-Wadern</label>
                    <label class="checkbox-item"><input type="checkbox" class="kreis-check" value="Neunkirchen" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Neunkirchen</label>
                    <label class="checkbox-item"><input type="checkbox" class="kreis-check" value="Regionalverband Saarbrücken" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Saarbrücken</label>
                    <label class="checkbox-item"><input type="checkbox" class="kreis-check" value="Saarlouis" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Saarlouis</label>
                    <label class="checkbox-item"><input type="checkbox" class="kreis-check" value="Saarpfalz-Kreis" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Saarpfalz-Kreis</label>
                    <label class="checkbox-item"><input type="checkbox" class="kreis-check" value="St. Wendel" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> St. Wendel</label>
                </div>
            </div>
        </div>

        <div class="menu-wrapper" style="top: 16%; z-index: 9000;">
            <div id="filter-kategorie" class="multiselect-container">
                <div class="select-box-header" onclick="toggleKatCheckboxes()">
                    <span id="selected-kat-text">- Festival-Kategorie -</span>
                </div>
                <div id="kat-checkbox-list" class="checkbox-content" style="display: none;">
                    <input type="checkbox" id="all-kategorien" style="display:none;" checked>
                    <div style="padding: 10px; display: flex; justify-content: center; gap: 15px; font-size: 13px; border-bottom: 1px solid #444; font-weight: bold;">
                        <span onclick="setAllKat(true)" style="cursor:pointer; color: #3498db;">[Alle an]</span>
                        <span onclick="setAllKat(false)" style="cursor:pointer; color: #e74c3c;">[Alle aus]</span>
                    </div>
                    <label class="checkbox-item"><input type="checkbox" class="kat-check" value="Electro Festivals" onchange="updateAllKatCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Electro Festivals</label>
                    <label class="checkbox-item"><input type="checkbox" class="kat-check" value="Mittelalter Festivals" onchange="updateAllKatCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Mittelalter Festivals</label>
                    <label class="checkbox-item"><input type="checkbox" class="kat-check" value="Punk Festivals" onchange="updateAllKatCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Punk Festivals</label>
                    <label class="checkbox-item"><input type="checkbox" class="kat-check" value="Schlager Festivals" onchange="updateAllKatCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Schlager Festivals</label>
                </div>
            </div>
        </div>

        <div class="menu-wrapper" style="top: 28%;">
            <div class="slider-container">
                <label for="preis-slider" class="slider-label">- Max. Preis: <span id="preis-wert">300</span> € -</label>
                <input type="range" id="preis-slider" min="0" max="300" step="10" value="300" oninput="filterKarte()">
            </div>
        </div>

        <div class="menu-wrapper" style="top: 40%;">
            <div class="slider-container" title="Tipp: Zeitraum wählen" style="background-color: rgb(30, 30, 30) !important;">
                <input type="text" id="event-kalender" style="display: none;">
            </div>
        </div>

        <div class="menu-wrapper" style="top: 88%;">
            <button id="reset-button" onclick="resetFilter()" style="background-color: rgb(30, 30, 30); color: white; border: none; border-radius: 9px; width: 100%; height: 40px; font-family: 'Montserrat', sans-serif; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; outline: none;">
                Filter zurücksetzen
            </button>
        </div>

        <div class="legende-links" style="top: 40%;"> <div class="legende-item"><div class="icon-wrapper"><img src="Symbole/Electro_symbol.png"></div><span>Electro</span></div>
            <div class="legende-item"><div class="icon-wrapper"><img src="Symbole/Mittelalter-Festival_schwarz_weiss_symbol.png"></div><span>Mittelalter</span></div>
            <div class="legende-item"><div class="icon-wrapper"><img src="Symbole/Punk_symbol.png"></div><span>Punk</span></div>
            <div class="legende-item"><div class="icon-wrapper"><img src="Symbole/Schlager_symbol.png"></div><span>Schlager</span></div>
        </div>

        <div class="impressum-wrapper" style="top: 70%;">
            <a href="extras/impressum.html" target="_blank" style="text-decoration: none;">
                <button id="impressum-button" 
					style="background-color: rgb(30, 30, 30);
					border: none;
					color: white;
					border-radius: 9px;
					width: 100%;
					height: 40px;
					font-family: 'Montserrat', sans-serif;
					font-weight: bold;
					cursor: pointer;
					box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);">
    Impressum
</button>
            </a>
        </div>
	 <div id="map"></div>
       
    </div>

		
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
      <!--  <script src="js/L.Control.Layers.Tree.min.js"></script> -->
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/multi-style-layer.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
        <script src="js/leaflet-search.js"></script>
        <script src="data/Kreise_1.js"></script>
        <script src="data/Festivals_kreis_2.js"></script>
        <script>
var festivalLinkListe = {};

fetch('url/url_adressen.txt?v=' + Date.now())
    .then(response => response.text())
    .then(data => {
        var zeilen = data.split(/\r?\n/);
        zeilen.forEach((zeile, index) => {
            if (index === 0) return; 
            var spalten = zeile.split(';');
            if (spalten.length >= 2) {
                var name = spalten[0].trim();
                var link = spalten[1].trim();
                if (name && link) {
                    festivalLinkListe[name] = link;
                }
            }
        });
        console.log("Bereinigte Liste geladen:", festivalLinkListe);
        if (typeof layer_Festivals_kreis_2 !== 'undefined') {
            layer_Festivals_kreis_2.eachLayer(function(layer) {
                pop_Festivals_kreis_2(layer.feature, layer);
            });
            console.log("Links auf der Karte wurden aktualisiert!");
        }
    })
    .catch(error => console.error('Fehler:', error));
			
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;
            highlightLayer.openPopup();
        }
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:7
        }).fitBounds([[48.95633153790181,6.124602242155099],[49.74555999436068,7.660429008508997]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');}}
       var zoomControl = L.control.zoom({
    position: 'topleft'
}).addTo(map);

L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);

// Routing-Reset: Keine Koordinaten, keine Symbole
var control = L.Routing.control({
    waypoints: [], // Liste ist komplett leer
    language: 'de',
    routeWhileDragging: true,
    show: true
}).addTo(map);
			
var bounds_group = new L.featureGroup([]);
function setBounds() {
}
map.createPane('pane_GoogleMaps_0');
map.getPane('pane_GoogleMaps_0').style.zIndex = 400;
        var layer_GoogleMaps_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=m&hl=de&x={x}&y={y}&z={z}', {
            pane: 'pane_GoogleMaps_0',
            opacity: 1.0,
            attribution: '© Google Maps',
            minZoom: 3,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 22
        });
        layer_GoogleMaps_0;
        map.addLayer(layer_GoogleMaps_0);
        function pop_Kreise_1(feature, layer) {
    if (feature.properties['gen'] !== null) {
        layer.bindTooltip(String(feature.properties['gen']), {
            sticky: true,
            className: 'landkreis-tooltip',
            direction: 'auto',
            offset: [15, 10]
        });
    }
    layer.on('add', function (e) {
        e.target.getElement().style.cursor = 'default';
    });
}
       function style_Kreise_1_0(feature) {
    return {
        pane: 'pane_Kreise_1',
        opacity: 1,
        color: 'rgba(110, 110, 110, 1)', 
        weight: 1.8,
        fill: true,
        fillOpacity: 0, 
        fillColor: 'rgba(100, 100, 100, 1.0)', 
        interactive: true,
    };
}
        map.createPane('pane_Kreise_1');
        map.getPane('pane_Kreise_1').style.zIndex = 401;
        map.getPane('pane_Kreise_1').style['mix-blend-mode'] = 'normal';
        var layer_Kreise_1 = new L.geoJson(json_Kreise_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Kreise_1',
            layerName: 'layer_Kreise_1',
            pane: 'pane_Kreise_1',
            onEachFeature: pop_Kreise_1,
            style: style_Kreise_1_0,
        });
        bounds_group.addLayer(layer_Kreise_1);
        map.addLayer(layer_Kreise_1);
		function getFestivalIcon(kategorie) {
	    var fileName;
	    switch(kategorie) {
	        case 'Electro Festivals':      fileName = 'Electro_symbol.png'; break;
	        case 'Mittelalter Festivals': fileName = 'Mittelalter-Festival_schwarz_weiss_symbol.png'; break;
	        case 'Punk Festivals':         fileName = 'Punk_symbol.png'; break;
	        case 'Schlager Festivals':     fileName = 'Schlager_symbol.png'; break;
	        default:                       fileName = 'default.png'; 
	    }
	    var isMobile = window.innerWidth <= 768;
    var iconSize   = isMobile ? [28, 28] : [44, 44]; 
    var iconAnchor = isMobile ? [14, 14] : [22, 22]; 
    return L.icon({
        iconUrl: 'Symbole/' + fileName,
        iconSize: iconSize, 
        iconAnchor: iconAnchor,
        className: 'festival-icon-style' 
    });
}
function pop_Festivals_kreis_2(feature, layer) {
    // 1. Tooltip (Name erscheint beim Drüberfahren)
    if (feature.properties['Festival_N']) {
        layer.bindTooltip(String(feature.properties['Festival_N']), {
            sticky: true,
            className: 'my-tooltip'
        });
    }

    // 2. Namen säubern und Link aus der Liste holen
    var fName = feature.properties['Festival_N'] ? feature.properties['Festival_N'].toString().trim() : 'Unbekanntes Festival';
    var zielUrl = festivalLinkListe[fName];

    // Falls noch nicht geladen oder nicht in der Liste, Google-Suche als Fallback
    if (!zielUrl || zielUrl === "") {
        zielUrl = "https://www.google.com/search?q=" + encodeURIComponent(fName + " Festival Saarland");
    }

    // 3. Der komplette HTML-Inhalt für das Popup
    var popupContent = '<div style="text-align: center; font-weight: bold; font-size: 17px; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 10px;">' + 
                        '<a href="' + zielUrl + '" target="_blank" rel="noopener noreferrer" style="color: #8e44ad; text-decoration: none;">' + 
                           fName + '<span style="font-size: 18px; margin-left: 8px;">&#10150;</span>' +
                        '</a>' +
                       '</div>' +
                       '<table>\
                        <tr><th scope="row">Kategorie</th><td>' + (feature.properties['Kategorie'] || '') + '</td></tr>\
                        <tr><th scope="row">Genre</th><td>' + (feature.properties['Genre'] || '') + '</td></tr>\
                        <tr style="height: 10px;"> <td colspan="2"></td> </tr>\
                        <tr><th scope="row">Preise ab</th><td>' + (feature.properties['Preise ab'] !== null ? parseFloat(feature.properties['Preise ab']).toFixed(2).replace('.', ',') + ' €' : '') + '</td></tr>\
                        <tr><th scope="row">Datum</th><td>' + (feature.properties['Datum'] || '') + '</td></tr>\
                        <tr><th scope="row">Dauer</th><td>' + (feature.properties['Dauer'] || '') + '</td></tr>\
                        <tr style="height: 10px;"> <td colspan="2"></td> </tr>\
                        <tr><th scope="row">Straße</th><td>' + (feature.properties['Straße'] || '') + '</td></tr>\
                        <tr><th scope="row">PLZ</th><td>' + (feature.properties['PLZ'] || '') + '</td></tr>\
                        <tr><th scope="row">Ort</th><td>' + (feature.properties['Ort'] || '') + '</td></tr>\
                        <tr><th scope="row">Landkreis</th><td>' + (feature.properties['gen'] || '') + '</td></tr>\
                    </table>';

    layer.bindPopup(popupContent, {
        minWidth: 350,
        maxWidth: 800,
        autoPan: true
    });
}
        map.createPane('pane_Festivals_kreis_2');
        map.getPane('pane_Festivals_kreis_2').style.zIndex = 402;
        map.getPane('pane_Festivals_kreis_2').style['mix-blend-mode'] = 'normal';
        var layer_Festivals_kreis_2 = new L.geoJson.multiStyle(json_Festivals_kreis_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Festivals_kreis_2',
            layerName: 'layer_Festivals_kreis_2',
            pane: 'pane_Festivals_kreis_2',
            onEachFeature: pop_Festivals_kreis_2,
            pointToLayers: [function (feature, latlng) { 
                var kat = String(feature.properties['Kategorie']);
                return L.marker(latlng, {
                    icon: getFestivalIcon(kat),
                    interactive: true
                });
            }] 
        }); 
        bounds_group.addLayer(layer_Festivals_kreis_2);
        map.addLayer(layer_Festivals_kreis_2);
    map.on("zoomend", function(e) {
    var zoom = map.getZoom();
    var minZoom = (window.innerWidth <= 768) ? 7 : 9;
    if (zoom <= 19 && zoom >= minZoom) {
        if (!map.hasLayer(layer_Festivals_kreis_2)) {
            map.addLayer(layer_Festivals_kreis_2);
        }
    } else {
        if (map.hasLayer(layer_Festivals_kreis_2)) {
            map.removeLayer(layer_Festivals_kreis_2);
        }
    }
});
        const url = {"Nominatim OSM": "https://nominatim.openstreetmap.org/search?format=geojson&addressdetails=1&","France BAN": "https://api-adresse.data.gouv.fr/search/?"}
        var photonControl = L.control.photon({
            url: url["Nominatim OSM"],
            feedbackLabel: '',
            position: 'topleft',
            includePosition: true,
            initial: true,
        }).addTo(map);
        var x = null;
        var marker = null;
        var z = null;
        photonControl.on('selected', function(e) {
            console.log(photonControl.search.resultsContainer);
            if (x != null) {
                map.removeLayer(obj3.marker);
                map.removeLayer(x);
            }
            obj2.gcd = e.choice;
            x = L.geoJSON(obj2.gcd).addTo(map);
            var label = typeof obj2.gcd.properties.label === 'undefined' ? obj2.gcd.properties.display_name : obj2.gcd.properties.label;
            obj3.marker = L.marker(x.getLayers()[0].getLatLng()).bindPopup(label).addTo(map);
            map.setView(x.getLayers()[0].getLatLng(), 17);
            z = typeof e.choice.properties.label === 'undefined'? e.choice.properties.display_name : e.choice.properties.label;
            console.log(e);
            e.target.input.value = z;
        });
        var search = document.getElementsByClassName("leaflet-photon leaflet-control")[0];
        search.classList.add("leaflet-control-search")
        search.style.display = "flex";
        var button = document.createElement("div");
        button.id = "gcd-button-control";
        button.className = "gcd-gl-btn fa fa-search search-button";
        search.insertBefore(button, search.firstChild);
        last = search.lastChild;
        last.style.display = "none";
        button.addEventListener("click", function (e) {
            if (last.style.display === "none") {
                last.style.display = "block";
            } else {
                last.style.display = "none";
            }
        });
        setBounds();
        map.addControl(new L.Control.Search({
            layer: layer_Festivals_kreis_2,
            initial: false,
            hideMarkerOnCollapse: true,
            propertyName: 'Genre'}));
        if (typeof url === 'undefined') {
            document.getElementsByClassName('search-button')[0].className += ' fa fa-binoculars';
        } else {
            document.getElementsByClassName('search-button')[1].className += ' fa fa-binoculars';
        }
		function setBounds() {
        }
        map.on("zoomend", function() {
            if (map.getZoom() > 11) {
                document.getElementById('map').classList.add('hide-tooltips');
            } else {
                document.getElementById('map').classList.remove('hide-tooltips');
            }
        });
function filterKarte() {
    var gewaehlteKreise = Array.from(document.querySelectorAll('.kreis-check:checked')).map(cb => cb.value);
    var alleKreiseAktiv = document.getElementById('all-kreise').checked;
    var alleKatAktiv = document.getElementById('all-kategorien').checked;
    var gewaehlteKat = Array.from(document.querySelectorAll('.kat-check:checked')).map(cb => cb.value);
    var gewaehlterPreis = parseFloat(document.getElementById('preis-slider').value);
    var gewaehlteDaten = festivalKalender.selectedDates;
    var startFilter = null;
    var endFilter = null;
    if (gewaehlteDaten.length > 0) {
        startFilter = gewaehlteDaten[0];
        endFilter = gewaehlteDaten[1] ? gewaehlteDaten[1] : startFilter;
    }
    var wertAnzeige = document.getElementById('preis-wert');
    if (wertAnzeige) wertAnzeige.innerText = gewaehlterPreis;
    var parseDate = function(str) {
        if(!str) return null;
        var d = str.trim().split('.');
        var tag = parseInt(d[0]);
        var monat = parseInt(d[1]) - 1;
        var jahr = d[2] ? parseInt(d[2]) : 2026;
        return new Date(jahr, monat, tag);
    };
    layer_Kreise_1.eachLayer(function(layer) {
        var name = String(layer.feature.properties['gen']);
        if (alleKreiseAktiv || gewaehlteKreise.includes(name)) {
            layer.setStyle({opacity: 1, weight: 1.2, interactive: true});
        } else {
            layer.setStyle({opacity: 0, weight: 0, interactive: false});
        }
    });
    layer_Festivals_kreis_2.eachLayer(function(layer) {
        if (layer.feature && layer.feature.properties) {
            var props = layer.feature.properties;
            var fKreis = String(props['gen']); 
            var fKat = String(props['Kategorie']);
            var fPreis = parseFloat(props['Preise ab']);
            var fDatumRaw = String(props['Datum']); 
            var datumCheck = true; 
            if (startFilter && endFilter) {
                var teile = fDatumRaw.split(/[-–]| bis /);
                var festivalStart = parseDate(teile[0]);
                var festivalEnd = teile[1] ? parseDate(teile[1]) : festivalStart;
                datumCheck = (festivalStart <= endFilter && festivalEnd >= startFilter);
            }
			var kreisCheck = (alleKreiseAktiv || gewaehlteKreise.includes(fKreis));
            var katCheck = (alleKatAktiv || gewaehlteKat.includes(fKat));
            var preisCheck = (isNaN(fPreis) || fPreis === null || fPreis <= gewaehlterPreis);
            if (layer.getElement()) {
                if (kreisCheck && katCheck && preisCheck && datumCheck) {
                    layer.getElement().style.display = 'block';
                } else {
                    layer.getElement().style.display = 'none';
                }
            }
        }
    });
}
function zentriereAufAuswahl() {
    var gewaehlteKreise = Array.from(document.querySelectorAll('.kreis-check:checked')).map(cb => cb.value);
    var alleKreiseAktiv = document.getElementById('all-kreise').checked;
    var bounds = new L.LatLngBounds();
    var hatSichtbareKreise = false;
    layer_Kreise_1.eachLayer(function(layer) {
        var name = String(layer.feature.properties['gen']);
        if (alleKreiseAktiv || gewaehlteKreise.includes(name)) {
            bounds.extend(layer.getBounds()); // Berechnet die Ausdehnung (Extents)
            hatSichtbareKreise = true;
        }
    });
    if (hatSichtbareKreise) {
        map.fitBounds(bounds, {
            padding: [30, 30], // Abstand zum Rand
            maxZoom: 12,       // Verhindert zu nahes Heranzoomen bei einem einzelnen Kreis
            animate: true      // Schwenkt die Karte weich
        });
    }
}
		function resetFilter() {
    document.getElementById('all-kreise').checked = true;
    document.querySelectorAll('.kreis-check').forEach(cb => cb.checked = true);
    document.querySelectorAll('.kat-check').forEach(cb => cb.checked = true);
    document.getElementById('preis-slider').value = 300;
    var preisAnzeige = document.getElementById('preis-wert');
    if (preisAnzeige) preisAnzeige.innerText = '300';
    if (festivalKalender) {
        festivalKalender.clear();
        festivalKalender.jumpToDate(new Date());
    }
    filterKarte();
}
	let festivalKalender;
		document.addEventListener("DOMContentLoaded", function() {
			const deCfg = {
				weekdays: {
				shorthand: ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"],
				longhand: ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"]},
				months: {
				shorthand: ["Jan", "Feb", "Mär", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez"],
				longhand: ["Januar", "Februar", "März", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"]},
			rangeSeparator: " bis ",
			firstDayOfWeek: 1 
		};
		festivalKalender = flatpickr("#event-kalender", {
			mode: "range",
			inline: true,
			static: true,
			locale: deCfg, 
			dateFormat: "d.m.Y",
			theme: "dark",
			monthSelectorType: "static",
				closeOnSelect: false,
				onChange: function(selectedDates, dateStr, instance) {
				        if (selectedDates.length > 0) {
				            filterKarte();
				        }
				    }
				});
			});
function toggleCheckboxes() {
    var list = document.getElementById("checkbox-list");
    if (list.style.display === "block") {
        list.style.display = "none";
    } else {
        list.style.display = "block";
    }
}
function setAll(status) {
    document.getElementById('all-kreise').checked = status;
    var checks = document.querySelectorAll('.kreis-check');
    checks.forEach(c => c.checked = status);
    filterKarte();
}
function toggleAllKreise(source) {
    var checks = document.querySelectorAll('.kreis-check');
    checks.forEach(c => c.checked = source.checked);
    filterKarte();
}
function updateAllCheckbox() {
    var allCheckbox = document.getElementById('all-kreise');
    var checks = document.querySelectorAll('.kreis-check');
    var total = checks.length;
    var checkedCount = document.querySelectorAll('.kreis-check:checked').length;
    allCheckbox.checked = (total === checkedCount);
}
// einstellungen für Checkbox Kategorie
function updateAllKatCheckbox() {
    var allCheckbox = document.getElementById('all-kategorien'); 
    var checks = document.querySelectorAll('.kat-check');
    var total = checks.length;
    var checkedCount = document.querySelectorAll('.kat-check:checked').length;
    allCheckbox.checked = (total === checkedCount);
}
function setAllKat(status) {
    document.getElementById('all-kategorien').checked = status;
    var checks = document.querySelectorAll('.kat-check');
    checks.forEach(c => c.checked = status);
    filterKarte();
}
function toggleAllKat(source) {
    var checks = document.querySelectorAll('.kat-check');
    checks.forEach(c => c.checked = source.checked);
    filterKarte();
}
function toggleKatCheckboxes() {
    var list = document.getElementById("kat-checkbox-list");
    if (list.style.display === "block") {
        list.style.display = "none";
    } else {
        list.style.display = "block";
    }
}	
	
       </script>
    </body>
</html>
